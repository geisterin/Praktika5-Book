# üìö Praktika5 ‚Äî Backend API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –∫–Ω–∏–≥

## –û–ø–∏—Å–∞–Ω–∏–µ

RESTful API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º –∫–Ω–∏–≥, –∞–≤—Ç–æ—Ä–∞–º–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–π (–∞–¥–º–∏–Ω/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å), –∑–∞–≥—Ä—É–∑–∫–æ–π –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤ –∫–Ω–∏–≥ (epub/fb2).

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```
DB_NAME=db_Romanaova_01_05
DB_USERNAME=ziroma
DB_PASSWORD=t231803
DB_HOST=dev.vk.edu.ee
DB_PORT=5432
DB_DIALECT=postgres


JWT_SECRET=–º–æ–π—Å–µ–∫—Ä–µ—Ç–Ω—ã–π–∫–ª—é—á123

PORT=3000
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∏–¥–µ—Ä—ã
```bash
npx sequelize-cli db:migrate
npx sequelize-cli db:seed:all
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
npm run dev
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ app.js
‚îú‚îÄ‚îÄ controllers/
‚îú‚îÄ‚îÄ middlewares/
‚îú‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ models/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ books/         # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–Ω–∏–≥ (epub/fb2)
‚îú‚îÄ‚îÄ routes/
‚îú‚îÄ‚îÄ seeders/
‚îú‚îÄ‚îÄ scripts/
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ README.md
```

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–æ–ª–∏
- JWT-—Ç–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤.
- –†–æ–ª–∏: `admin` (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø), `user` (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏).
- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:
  ```
  Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>
  ```

---

## üìë –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/signup` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /auth/signin` ‚Äî –≤—Ö–æ–¥

### –ö–Ω–∏–≥–∏
- `GET /books` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
- `GET /books/:id` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ
- `POST /books` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É (**admin**)
- `PUT /books/:id` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É (**admin**)
- `DELETE /books/:id` ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É (**admin**)
- `POST /books/:id/upload` ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –∫–Ω–∏–≥–∏ (epub/fb2, **admin**)
- `GET /books/:id/download` ‚Äî —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –∫–Ω–∏–≥–∏ (**user**)

### –ê–≤—Ç–æ—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `GET /authors`, `GET /categories` ‚Äî —Å–ø–∏—Å–∫–∏
- `POST /authors`, `POST /categories` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å (**admin**)

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- `POST /books/:id/comments` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- `GET /books/:id/comments` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

---

## üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–Ω–∏–≥
- **–ó–∞–≥—Ä—É–∑–∫–∞:**
  - –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /books/:id/upload` (–ø–æ–ª–µ `bookFile` –≤ FormData).
  - –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `public/books/`.
  - –í –±–∞–∑–µ —É –∫–Ω–∏–≥–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ `file_url`.
- **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ:**
  - `GET /books/:id/download` ‚Äî –æ—Ç–¥–∞—ë—Ç —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å).

> ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** —Å–µ–π—á–∞—Å –∫–Ω–∏–≥–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `public/books`, –Ω–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ backend-—Ä–æ—É—Ç–∞. –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∫–Ω–æ–ø–∫–∏ "–°–∫–∞—á–∞—Ç—å" –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ñ–∞–π–ª–∞.

---

## üõ† –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∫–Ω–∏–≥–∏ (admin)
```bash
curl -X POST http://localhost:3000/books/1/upload \
  -H "Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>" \
  -F "bookFile=@/path/to/book.epub"
```

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–Ω–∏–≥–∏ (user)
```bash
curl -X GET http://localhost:3000/books/1/download \
  -H "Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>" --output book.epub
```

---

## üìù Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
- http://localhost:3000/api-docs

---

## üß© –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ TODO
- –í—Å–µ —Ñ–∞–π–ª—ã –∫–Ω–∏–≥ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `public/books/`.
- –í –±–∞–∑–µ —É –∫–Ω–∏–≥–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (`file_url`).
- –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.
- **TODO:** –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–Ω–∏–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
- **TODO:** –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.

---

## ü§ù –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏ –≤ issues –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É!

